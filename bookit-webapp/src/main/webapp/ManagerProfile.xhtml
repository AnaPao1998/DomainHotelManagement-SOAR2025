<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">

<ui:composition template="/templates/ManagerTemplate.xhtml">

    <f:metadata>
        <f:event type="preRenderView" listener="#{managerBean.loadManager}" />
    </f:metadata>

    <ui:define name="pageTitle">Manager | Profile</ui:define>

    <ui:define name="managerContent">
        <p:panel style="margin-top: 15px;">

            <h1>#{managerBean.firstName} #{managerBean.lastName}'s Profile</h1>

            <p:growl id="infoGrowl" showDetail="false"/>

            <p:outputLabel value="Basic Information"/>
            <h:form id="basicInfo">

                <p:outputLabel for="@next" value="First Name" style="font-size: 12px;"/><br/>
                <p:inputText id="firstname" value="#{managerBean.firstName}" required="true"
                             requiredMessage="First name is required.">
                    <p:ajax event="blur" update="basicInfo updateButton" listener="#{managerBean.checkIfChanged()}"/>
                    <p:ajax event="keyup" update="basicInfo updateButton" listener="#{managerBean.checkIfChanged()}"/>
                </p:inputText>
                <p:message for="firstname" display="text"/>
                <br/>

                <p:outputLabel for="@next" value="Last Name" style="font-size: 12px;"/><br/>
                <p:inputText id="lastname" value="#{managerBean.lastName}" required="true"
                             requiredMessage="Last name is required.">
                    <p:ajax event="blur" update="basicInfo updateButton" listener="#{managerBean.checkIfChanged()}"/>
                    <p:ajax event="keyup" update="basicInfo updateButton" listener="#{managerBean.checkIfChanged()}"/>
                </p:inputText>
                <p:message for="lastname" display="text"/>
                <br/>

                <p:outputLabel for="@next" value="Email" style="font-size: 12px;"/><br/>
                <p:inputText id="email" value="#{managerBean.email}" required="true"
                             requiredMessage="Email is required." validatorMessage="Incorrect email format.">
                    <p:ajax event="blur" update="basicInfo updateButton" listener="#{managerBean.checkIfChanged()}"/>
                    <p:ajax event="keyup" update="basicInfo updateButton" listener="#{managerBean.checkIfChanged()}"/>
                    <f:validateRegex pattern="^[^@]+@[^@]+\.[^@]+$"/>
                </p:inputText>
                <p:message for="email" display="text"/>
                <br/>

                <p:spacer height="30"/>

                <p:commandButton id="updateButton" value="Update" disabled="#{!managerBean.changed}"
                                 action="#{managerBean.updateManager()}"
                                 update="basicInfo infoGrowl"/>
                <p:spacer width="10"/>

                <p:commandButton id="undoButton" value="Undo" actionListener="#{managerBean.loadManager()}" immediate="true"
                                 update="basicInfo" oncomplete="window.location.reload();"/>

                <p:dialog id="updateErrorDialog"
                          widgetVar="updateErrorDialog"
                          header="Update Failed"
                          modal="true"
                          resizable="true"
                          width="250"
                          height="50">
                    <h:outputText id="updateErrorMessage" value="#{managerBean.dialogMessage}"/>
                </p:dialog>
            </h:form>
            <br/>

            <p:outputLabel value="Change Password"/>
            <h:form id="changePasswordForm">

                <p:dialog id="passwordChangeDialog"
                          widgetVar="passwordChangeDialog"
                          header="Password Change"
                          modal="true"
                          resizable="true"
                          width="400"
                          height="100">
                    <h:outputText id="passwordChangeMessage" value="#{managerBean.dialogMessage}"/>
                </p:dialog>

                <p:outputLabel for="@next" value="Current Password" style="font-size: 12px;"/><br/>
                <p:password id="currentPassword" value="#{managerBean.currentPassword}" autocomplete="new-password"
                            redisplay="true" toggleMask="true" feedback="false"
                            required="true" requiredMessage="Current password is required."/>
                <p:message for="currentPassword" display="text"/>
                <br/>

                <p:outputLabel for="@next" value="New Password" style="font-size: 12px;"/><br/>
                <p:password id="newPassword" value="#{managerBean.newPassword}" autocomplete="new-password"
                            redisplay="true" toggleMask="true" feedback="false"
                            required="true" requiredMessage="New password is required."/>
                <p:message for="newPassword" display="text"/>
                <br/>

                <p:spacer height="30"/>

                <p:commandButton id="changePasswordButton" value="Save"
                                 action="#{managerBean.savePasswordChange()}"
                                 update="changePasswordForm passwordChangeDialog infoGrowl"/>
                <p:spacer width="10"/>

                <p:commandButton id="resetPasswordButton" value="Reset"
                                 actionListener="#{managerBean.resetPasswordChange()}" immediate="true"
                                 update="changePasswordForm" oncomplete="window.location.reload();"/>
            </h:form>
            <br/>

            <h:form id="hotelManagementLinks">
                <p:outputLabel value="Hotel Management Options" style="font-weight: bold;"/>
                <br/>
                <p:spacer height="10"/>
                <p:button value="Manage My Hotel(s)" outcome="HotelManagement.xhtml" icon="pi pi-building"/>
            </h:form>
        </p:panel>
    </ui:define>

</ui:composition>
</html>