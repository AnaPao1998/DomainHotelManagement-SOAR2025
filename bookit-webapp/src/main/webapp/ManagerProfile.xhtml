<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">

<ui:composition template="/templates/ManagerTemplate.xhtml">

    <f:metadata>
        <f:event type="preRenderView" listener="#{managerBean.loadManager}" />
    </f:metadata>

    <ui:define name="pageTitle">Manager | Profile Settings</ui:define>

    <ui:define name="managerContent">

        <p:panel styleClass="p-shadow-3 p-mt-3">

            <h:panelGroup layout="block" styleClass="p-mb-4">
                <h1>⚙️ Profile Settings for #{managerBean.firstName} #{managerBean.lastName}</h1>
                <p>Manage your personal information and security credentials.</p>
            </h:panelGroup>

            <p:growl id="infoGrowl" showDetail="true" life="4000"/>

            <div class="p-grid p-dir-row p-nogutter">

                <div class="p-col-12 p-lg-6 p-pr-lg-3">
                    <p:fieldset legend="Update Basic Information" styleClass="p-mb-3">
                        <h:form id="basicInfoForm">
                            <p:panelGrid columns="1" layout="grid" styleClass="ui-fluid">

                                <p:outputLabel for="firstname" value="First Name"/>
                                <p:inputText id="firstname" value="#{managerBean.firstName}" required="true"
                                             requiredMessage="First name is required.">
                                    <p:ajax event="blur" update="updateButton" listener="#{managerBean.checkIfChanged()}" process="@this"/>
                                </p:inputText>
                                <p:message for="firstname" display="text"/>

                                <p:outputLabel for="lastname" value="Last Name"/>
                                <p:inputText id="lastname" value="#{managerBean.lastName}" required="true"
                                             requiredMessage="Last name is required.">
                                    <p:ajax event="blur" update="updateButton" listener="#{managerBean.checkIfChanged()}" process="@this"/>
                                </p:inputText>
                                <p:message for="lastname" display="text"/>

                                <p:outputLabel for="email" value="Email"/>
                                <p:inputText id="email" value="#{managerBean.email}" required="true"
                                             requiredMessage="Email is required." validatorMessage="Incorrect email format.">
                                    <p:ajax event="blur" update="updateButton" listener="#{managerBean.checkIfChanged()}" process="@this"/>
                                    <f:validateRegex pattern="^[^@]+@[^@]+\.[^@]+$"/>
                                </p:inputText>
                                <p:message for="email" display="text"/>

                            </p:panelGrid>

                            <h:panelGroup styleClass="p-mt-3 p-d-flex">
                                <p:commandButton id="updateButton" value="Save Changes"
                                                 disabled="#{!managerBean.changed}"
                                                 action="#{managerBean.updateManager()}"
                                                 update="basicInfoForm infoGrowl :messageDialog"
                                                 styleClass="ui-button-primary p-mr-2"/>

                                <p:commandButton id="undoButton" value="Undo Changes"
                                                 actionListener="#{managerBean.loadManager()}"
                                                 immediate="true"
                                                 update="basicInfoForm"
                                                 styleClass="ui-button-secondary"/>
                            </h:panelGroup>
                        </h:form>
                    </p:fieldset>
                </div>

                <div class="p-col-12 p-lg-6 p-pl-lg-3">
                    <p:fieldset legend="Change Password" styleClass="p-mb-3">
                        <h:form id="changePasswordForm">
                            <p:panelGrid columns="1" layout="grid" styleClass="ui-fluid">

                                <p:outputLabel for="currentPassword" value="Current Password"/>
                                <p:password id="currentPassword" value="#{managerBean.currentPassword}" autocomplete="new-password"
                                            redisplay="true" toggleMask="true" feedback="true"
                                            required="true" requiredMessage="Current password is required."/>
                                <p:message for="currentPassword" display="text"/>

                                <p:outputLabel for="newPassword" value="New Password"/>
                                <p:password id="newPassword" value="#{managerBean.newPassword}" autocomplete="new-password"
                                            redisplay="true" toggleMask="true" feedback="true"
                                            required="true" requiredMessage="New password is required."/>
                                <p:message for="newPassword" display="text"/>

                            </p:panelGrid>

                            <h:panelGroup styleClass="p-mt-3 p-d-flex">
                                <p:commandButton id="changePasswordButton" value="Save New Password"
                                                 action="#{managerBean.savePasswordChange()}"
                                                 update="changePasswordForm :messageDialog infoGrowl"
                                                 styleClass="ui-button-warning p-mr-2"/>

                                <p:commandButton id="resetPasswordButton" value="Reset Fields"
                                                 actionListener="#{managerBean.resetPasswordChange()}" immediate="true"
                                                 update="changePasswordForm" styleClass="ui-button-secondary"/>
                            </h:panelGroup>
                        </h:form>
                    </p:fieldset>
                </div>
            </div>

            <p:separator/>

            <h:form id="actionLinksForm">
                <p:outputLabel value="Hotel Management Options" styleClass="p-text-bold p-d-block p-mb-2"/>
                <p:button value="Go to Hotel Management Dashboard" outcome="ManagerHome.xhtml" icon="pi pi-building" styleClass="ui-button-info"/>
            </h:form>

        </p:panel>

        <p:dialog widgetVar="messageDialog" header="Operation Status" modal="true" width="300">
            <h:outputText value="#{managerBean.dialogMessage}" />
            <p:commandButton value="Close" onclick="PF('messageDialog').hide()" type="button" styleClass="p-mt-3"/>
        </p:dialog>

    </ui:define>

</ui:composition>
</html>