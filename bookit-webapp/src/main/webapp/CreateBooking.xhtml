<?xml version="1.0" encoding="UTF-8"?>

<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                template="/templates/GuestTemplate.xhtml">

<f:metadata>
        <f:event type="preRenderView" listener="#{guestBean.loadGuest}" />
    </f:metadata>

    <ui:define name="pageTitle">Bookit | New Booking</ui:define>

    <ui:define name="guestContent">

        <h:panelGroup layout="block" styleClass="p-mt-3 p-mb-4">
            <h1>Create a New Booking</h1>
            <p>You selected a hotel. Please choose a room type and confirm your reservation.</p>
        </h:panelGroup>

        <p:growl id="infoGrowl" showDetail="true" life="4000"/>

        <!-- If no hotel was selected (user came here directly), show a helpful message -->
        <h:panelGroup rendered="#{guestBean.selectedHotelForBooking eq null}">
            <p:panel header="No hotel selected">
                <h:outputText
                        value="Please go to the hotel search page, select a hotel to book, and then return here."/>
            </p:panel>
        </h:panelGroup>

        <!-- Main booking form: only shown when a hotel was selected from HotelSearch.xhtml -->
        <h:panelGroup rendered="#{guestBean.selectedHotelForBooking ne null}">

            <p:panel header="1. Booking Details" styleClass="p-mt-3 p-mb-4">
                <h:form id="confirmationForm">

                    <h:panelGroup id="confirmationPanel">

                        <p:panelGrid columns="2" columnClasses="label,value" styleClass="ui-fluid p-mb-3">

                            <p:outputLabel value="Hotel"/>
                            <h:outputText value="#{guestBean.selectedHotelForBooking.name}"/>

                            <p:outputLabel value="City"/>
                            <h:outputText value="#{guestBean.selectedHotelForBooking.city}"/>

                            <p:outputLabel value="Country"/>
                            <h:outputText value="#{guestBean.selectedHotelForBooking.country}"/>

                            <!-- Room type selector â€“ adapt roomTypes/fields if your model differs -->
                            <p:outputLabel for="roomTypeSelect" value="Room Type"/>
                            <p:selectOneMenu id="roomTypeSelect"
                                             value="#{guestBean.selectedRoomTypeCode}"
                                             styleClass="ui-fluid"
                                             required="true"
                                             requiredMessage="Please select a room type.">
                                <f:selectItem itemLabel="-- Select --"
                                              itemValue=""
                                              noSelectionOption="true" />
                                <f:selectItems value="#{guestBean.roomTypeOptions}"
                                               var="rt"
                                               itemLabel="#{rt}"
                                               itemValue="#{rt}" />
                            </p:selectOneMenu>



                        </p:panelGrid>

                        <p:separator/>

                        <p:commandButton value="Confirm Booking"
                                         actionListener="#{guestBean.confirmBooking}"
                                         update="@form :messageDialog infoGrowl"
                                         icon="pi pi-check"
                                         styleClass="ui-button-success"/>

                    </h:panelGroup>

                </h:form>
            </p:panel>

        </h:panelGroup>

        <p:dialog id="messageDialog"
                  widgetVar="messageDialog"
                  header="Operation Status"
                  modal="true"
                  width="300">
            <h:outputText value="#{guestBean.dialogMessage}" />
            <p:commandButton value="Close"
                             onclick="PF('messageDialog').hide()"
                             type="button"
                             styleClass="p-mt-3"/>
        </p:dialog>


    </ui:define>

</ui:composition>